{
  "id": "SYS-ATTR-06",
  "title": "Normalize macro sugar to canonical objc_resource spelling in emitted interfaces",
  "feature": "Part 8 canonical system attribute spellings in interfaces",
  "bucket": "module_roundtrip",
  "profile": "strict-system",
  "references": [
    "spec/CONFORMANCE_PROFILE_CHECKLIST.md#e-3-8",
    "spec/PART_8_SYSTEM_PROGRAMMING_EXTENSIONS.md#part-8",
    "spec/ATTRIBUTE_AND_SYNTAX_CATALOG.md#b-8",
    "spec/PART_8_SYSTEM_PROGRAMMING_EXTENSIONS.md#part-8-0-1",
    "spec/ATTRIBUTE_AND_SYNTAX_CATALOG.md#b-8-1",
    "spec/PART_2_MODULES_NAMESPACING_API_SURFACES.md#part-2-5-1"
  ],
  "source": "// RUN: objc3c -fobjc-version=3 --emit-module SYSATTR06.objcmod --emit-interface SYSATTR06.obji %s\n// RUN: objc3c --verify-interface SYSATTR06.objcmod SYSATTR06.obji %s\n#define SYS_RESOURCE(CLOSE_FN, INVALID_VALUE) __attribute__((objc_resource(close=CLOSE_FN, invalid=INVALID_VALUE)))\ntypedef int objc_handle_t;\nvoid close_socket(objc_handle_t socket_fd);\nextern objc_handle_t gTrackedSocket SYS_RESOURCE(close_socket, -1);\n",
  "expect": {
    "parse": "accept",
    "diagnostics": [],
    "canonical_interface": "typedef int objc_handle_t;\nvoid close_socket(objc_handle_t socket_fd);\nextern objc_handle_t gTrackedSocket __attribute__((objc_resource(close=close_socket, invalid=-1)));\n",
    "canonicalization": {
      "normalizes_noncanonical_input": true,
      "normalization_pairs": [
        {
          "from": "SYS_RESOURCE(close_socket, -1)",
          "to": "__attribute__((objc_resource(close=close_socket, invalid=-1)))"
        }
      ],
      "forbidden_noncanonical_spellings": [
        "SYS_RESOURCE(close_socket, -1)"
      ]
    }
  }
}
